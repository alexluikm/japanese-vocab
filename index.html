<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>選擇詞語</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>選擇詞語</h1>
    <p>請選擇最多 30 個詞語：</p>
    <p>還可以選擇 <span id="counter">30</span> 個詞語</p>
    <div id="word-selection-list">
        <!-- 詞語選擇卡片會動態生成在這裡 -->
    </div>
    <button id="random-selection">隨機選擇</button> <!-- 新增隨機選擇按鈕 -->
    <button id="confirm-selection">確認選擇</button>

    <script src="words.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("頁面已加載！");

            const wordSelectionList = document.getElementById('word-selection-list');
            const counter = document.getElementById('counter');
            let remaining = 30;

            // 生成詞語選擇卡片
            words.forEach(word => {
                const card = document.createElement('div');
                card.className = 'word-card';
                card.innerHTML = `
                    <div>
                        <input type="checkbox" id="${word.kanji}" value="${word.kanji}">
                        <label for="${word.kanji}">
                            <div class="kanji">${word.kanji}</div>
                            <div class="hiragana">${word.hiragana}</div>
                            <div class="category">${word.category}</div>
                        </label>
                    </div>
                `;
                wordSelectionList.appendChild(card);

                // 綁定選擇框的點擊事件
                const checkbox = card.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('click', () => {
                    if (checkbox.checked) {
                        remaining -= 1;
                    } else {
                        remaining += 1;
                    }
                    counter.textContent = remaining;

                    // 如果剩餘可選詞語為 0，禁用未選中的選擇框
                    const checkboxes = document.querySelectorAll('#word-selection-list input[type="checkbox"]');
                    checkboxes.forEach(cb => {
                        if (remaining === 0 && !cb.checked) {
                            cb.disabled = true;
                        } else {
                            cb.disabled = false;
                        }
                    });
                });
            });

            // 隨機選擇按鈕
            document.getElementById('random-selection').addEventListener('click', () => {
                const checkboxes = document.querySelectorAll('#word-selection-list input[type="checkbox"]');
                let remainingWords = 30;

                // 先取消所有已選中的詞語
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.disabled = false;
                });

                // 隨機選擇最多 30 個詞語
                const shuffledWords = words.sort(() => 0.5 - Math.random()).slice(0, 30);
                shuffledWords.forEach(word => {
                    const checkbox = document.querySelector(`#word-selection-list input[value="${word.kanji}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        remainingWords -= 1;
                    }
                });

                // 更新剩餘可選詞語數量
                remaining = remainingWords;
                counter.textContent = remaining;

                // 如果剩餘可選詞語為 0，禁用未選中的選擇框
                checkboxes.forEach(cb => {
                    if (remaining === 0 && !cb.checked) {
                        cb.disabled = true;
                    }
                });
            });

            // 確認選擇
            document.getElementById('confirm-selection').addEventListener('click', () => {
                const selectedWords = Array.from(document.querySelectorAll('#word-selection-list input[type="checkbox"]:checked'))
                    .map(input => words.find(word => word.kanji === input.value));

                if (selectedWords.length > 30) {
                    alert("請選擇最多 30 個詞語！");
                    return;
                }

                // 將選擇的詞語存儲到 localStorage
                localStorage.setItem('selectedWords', JSON.stringify(selectedWords));
                console.log("已存儲選擇的詞語：", selectedWords); // 調試用

                // 跳轉到 memory-mode.html
                window.location.href = 'memory-mode.html';
            });
        });
    </script>
</body>
</html>